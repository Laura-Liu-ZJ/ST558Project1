---
title: "Project1"
author: "Zhijun Liu"
date: "`r Sys.Date()`"
output:  
  rmarkdown::github_document:
    toc: yes
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
	echo = TRUE,
	message = FALSE,
	warning = FALSE,
  comment = "#>"
)
```

```{r,echo=FALSE}
# prepare for the packages
library(httr)
library(jsonlite)
library(tidyverse)
library(DT)
library(knitr)
```

# Abstract
*What did I do + brief results*

# Introduction
## Description of JSON Data
### What it is?

JSON (JavaScript Object Notation) is an open standard file format, and data interchange format, that uses human-readable text to store and transmit data objects consisting of attribute–value pairs and array data types (or any other serializable value). JSON is a language-independent data format. It was derived from JavaScript, but many modern programming languages include code to generate and parse JSON-format data.(https://en.wikipedia.org/wiki/JSON)

### Where does it get used?

JSON is commonly used for transmitting data in web applications (e.g., sending some data from the server to the client, so it can be displayed on a web page, or vice versa). And It’s also becoming an increasingly common format for database migration from modern apps (such as MixPanel, SalesForce, and Shopify) over to SQL databases.(https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Objects/JSON)

### Why is it a good way to store data?

JSON is perfect for storing temporary data that’s consumed by the entity that creates the data. A good example is user-generated data such as filling out a form or information exchange between an API and an app. Stored JSON data must be text but this means JSON can be used as a data format for any programming language, providing a high level of interoperability. It also means data stored in JSON files are easily sent between servers. This is a bonus for database migration.(https://blog.sqlizer.io/posts/json-store-data/)

## Discussion on R packages for reading JSON data

- `rjson`: This does not use S4/S3 methods and so is not readily extensible, but still useful. Unfortunately, it does not used vectorized operations and so is too slow for non-trivial data. Similarly, for reading JSON data into R, it is somewhat slow and so does not scale to large data, should this be an issue.

- `RJSONIO`: This is an alternative to `rjson` package. Originally, that was too slow for converting large R objects to JSON and was not extensible. rjson's performance is now similar to this package, and perhaps slightly faster in some cases. The two packages intentionally share the same basic interface. This package (`RJSONIO`) has many additional options to allow customizing the generation and processing of JSON content. This package uses libjson rather than implementing yet another JSON parser. 

- `jsonlite`: This is a fork of the `RJSONIO` package. It builds on the parser from `RJSONIO` but implements a different mapping between R objects and JSON strings. The C code in this package is mostly from the `RJSONIO` Package, the R code has been rewritten from scratch. In addition to drop-in replacements for `fromJSON` and `toJSON`, the package has functions to serialize objects. Furthermore, the package contains a lot of unit tests to make sure that all edge cases are encoded and decoded consistently for use with dynamic data in systems and applications. Thus, I choose `jsonlite`.

# NHL & NHL Data
## What is NHL?
```{r}
include_graphics("D:/2020_3rd_semester/ST558/6. Project/WeaverLankow.jpg")
```

The National Hockey League (NHL) is a professional ice hockey league in North America, currently comprising 31 teams: 24 in the United States and seven in Canada. The NHL is considered to be the premier professional ice hockey league in the world, and one of the major professional sports leagues in the United States and Canada. The Stanley Cup, the oldest professional sports trophy in North America, is awarded annually to the league playoff champion at the end of each season.(https://en.wikipedia.org/wiki/National_Hockey_League)

The NHL divides the 31 teams into two conferences: the Eastern Conference and the Western Conference. Each conference is split into two divisions: the Eastern Conference contains 16 teams (eight per division), while the Western Conference has 15 teams (seven in the Central Division and eight in the Pacific Division). The current alignment has existed since the 2017–18 season.(https://en.wikipedia.org/wiki/Category:National_Hockey_League_teams)

## View the NHL data

```{r}
# write a function to get specific url
url <- function(kind,ID=NULL){
  base_url <- "https://records.nhl.com/site/api/franchise"
  if(kind == "base"){
    return("https://records.nhl.com/site/api/franchise")}
  else if(kind == "TeamTotal"){
    return( paste(base_url, "team","totals", sep="-"))
  }else{
    return(paste0(paste(base_url,kind,"records",sep="-"),"?",paste("cayenneExp","franchiseId",ID,sep="=")))
  }
}
# write a function to get data from specific url
GetData <- function(url){
  url %>%
    GET(.) %>%
    # turn it into JSON text form
    content(as="text") %>%
    # convert it to a list
    fromJSON(flatten=TRUE) 
}
```

```{r,cache=TRUE}
# call above two functions together to get specific data
Franchise <- GetData(url("base"))$data
TeamTotal <- GetData(url("TeamTotal"))$data
# write a function to combine all the id(1-38) of specific table
CData <- function(kind){
  y <- NULL
  for(i in 1:38){
    x <- GetData(url(kind,ID=as.character(i)))$data
    y <- rbind(x,y)
  }
  return(y)
}
# get the season table of all id
Season <- CData("season")
# get the goalie table of all id
Goalie <- CData("goalie")
# get the skater table of all id
Skater <- CData("skater")
```

```{r}
# view the data set
tbl_df(Franchise) %>% 
  select(id,contains("Name")) %>% 
  rename("franchiseId"=id)
tbl_df(TeamTotal) %>% 
  select(franchiseId,teamId,activeFranchise,gameTypeId,losses,wins,ties,points,pointPctg) %>%
  mutate(winPct= wins/(losses+wins+ties))
tbl_df(Season) %>% 
  select(14,6,8,10,12,13,mostLosses,mostPoints,mostTies,mostWins,mostWinsSeasons)
  
tbl_df(Goalie) %>% 
  select(4,3,losses,ties,wins) %>%
  mutate(winPct= wins/(losses+wins+ties))

tbl_df(Skater) %>% 
  select(5,4,goals,points)
```

## The reason of variable I choose



# Exploratory Data Analysis
## Categorical data
*which data is categorical data*
*why we choose this categorical data*


### Statistical Summary for categorical data
*contingency table*

```{r}
# how many teams are in each franchise
table(TeamTotal$franchiseId)
# how many teams are in each game type
table(TeamTotal$gameTypeId)
# how many teams are in each condition of franchise
table(TeamTotal$activeFranchise)

table(TeamTotal$franchiseId,TeamTotal$activeFranchise)
# table(TeamTotal$firstSeasonId,TeamTotal$activeFranchise)
```

```{r}
# sapply(NHLid,function(x){summary(x)})
# sapply(TeamTotal,function(x){summary(x)})
```


### Graph display for categorical data
*bar chart*
```{r}

```

## Numeric data
*which data is categorical data*
*why we choose this categorical data*


### Statistical summary for numeric data
*summary function*
```{r}

```

### Graph display for numeric data
*box plot, histogram, scatterplot*
```{r}

```

# Conclusion

# Discussion on this project
## what would you do differently?
## what was the most difficult part for you?
## what are your big take-aways from this project?
